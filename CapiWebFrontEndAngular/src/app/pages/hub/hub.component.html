<div class="hub-container" #container [@containerAnimation]>
  <div class="app-container">
    <!-- MOBILE VIEW -->
    <div class="mobile-status-bar">
      <!-- Hidden as per CSS -->
    </div>

    <div class="mobile-header">
      <div class="header-top">
        <div>
          <div class="mobile-time">{{ currentTime() }}</div>
          <div class="mobile-date">{{ currentDate() }}</div>
        </div>
        <div class="user-section mobile">
          @if (user()) {
          <div class="user-avatar" [class.active]="showUserMenu()" (click)="toggleUserMenu()">
            {{ user().username.substring(0, 2).toUpperCase() }}
            @if (showUserMenu()) {
            <div class="user-dropdown" (click)="$event.stopPropagation()">
              <div class="dropdown-item" (click)="openEditModal()">Editar datos</div>
              <div class="dropdown-item" (click)="logout()">Cerrar sesi칩n</div>
            </div>
            }
          </div>
          } @else {
          <div class="user-avatar guest" [class.active]="showUserMenu()" (click)="toggleUserMenu()">
            游녻
            @if (showUserMenu()) {
            <div class="user-dropdown" (click)="$event.stopPropagation()">
              <div class="dropdown-item" (click)="navigateToLogin()">Iniciar sesi칩n</div>
              <div class="dropdown-item" (click)="navigateToRegister()">Registrarse</div>
            </div>
            }
          </div>
          }
        </div>
      </div>
      <div class="mobile-search">
        <span class="mobile-search-icon">游댌</span>
        <input type="text" placeholder="Buscar apps" [value]="searchTerm()"
          (input)="updateSearch($any($event.target).value)">
      </div>
    </div>

    <div class="mobile-apps">
      <div class="mobile-page">
        <div class="mobile-grid">
          @for (app of filteredApps(); track app.route) {
          <div class="mobile-app" (click)="navigateTo(app.route)">
            <div class="mobile-app-icon">
              {{ app.icon }}
            </div>
            <div class="mobile-app-name">{{ app.title }}</div>
          </div>
          }
        </div>
      </div>
    </div>

    <div class="mobile-dock">
      <!-- Hidden as per CSS -->
    </div>

    <!-- DESKTOP VIEW -->
    <div class="desktop-layout">
      <nav class="nav-bar">
        <div class="brand">
          <!-- <div class="brand-icon">A</div> -->
          <div class="brand-name">HUB</div>
        </div>
        <div class="user-section">
          <div class="search-box">
            <span class="search-icon">游댌</span>
            <input type="text" class="search-input" placeholder="Buscar aplicaciones..." [value]="searchTerm()"
              (input)="updateSearch($any($event.target).value)">
          </div>

          @if (user()) {
          <div class="user-avatar" [class.active]="showUserMenu()" (click)="toggleUserMenu()">
            {{ user().username.substring(0, 2).toUpperCase() }}
            @if (showUserMenu()) {
            <div class="user-dropdown" (click)="$event.stopPropagation()">
              <div class="dropdown-item" (click)="openEditModal()">Editar datos</div>
              <div class="dropdown-item" (click)="logout()">Cerrar sesi칩n</div>
            </div>
            }
          </div>
          } @else {
          <div class="user-avatar guest" [class.active]="showUserMenu()" (click)="toggleUserMenu()">
            游녻
            @if (showUserMenu()) {
            <div class="user-dropdown" (click)="$event.stopPropagation()">
              <div class="dropdown-item" (click)="navigateToLogin()">Iniciar sesi칩n</div>
              <div class="dropdown-item" (click)="navigateToRegister()">Registrarse</div>
            </div>
            }
          </div>
          }
        </div>
      </nav>

      <header class="main-header">
        <h1 class="greeting">{{ greeting() }}</h1>
        <p class="subheading">Aqu칤 est치n tus aplicaciones disponibles</p>
      </header>

      <section class="category-section">
        <div class="apps-grid">
          @for (app of filteredApps(); track app.route) {
          <div class="app-item" (click)="navigateTo(app.route)">
            <div class="app-content">
              <div class="app-icon-wrapper">{{ app.icon }}</div>
              <div class="app-info">
                <h3>{{ app.title }}</h3>
                <p>{{ app.description }}</p>
              </div>
            </div>
          </div>
          }
        </div>
      </section>
    </div>
  </div>

  @if (showEditModal()) {
  <div class="modal-backdrop" (click)="closeEditModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Editar mis datos</h3>
        <button class="close-btn" (click)="closeEditModal()">칑</button>
      </div>

      @if (editError()) {
      <div class="alert error">{{ editError() }}</div>
      }
      @if (editSuccess()) {
      <div class="alert success">{{ editSuccess() }}</div>
      }

      <div class="form-group">
        <label>Usuario</label>
        <input type="text" [value]="editData().username"
          (input)="onEditFieldChange('username', $any($event.target).value)" />
      </div>

      <div class="form-group">
        <label>Email</label>
        <input type="email" [value]="editData().email"
          (input)="onEditFieldChange('email', $any($event.target).value)" />
      </div>

      <div class="form-group">
        <label>Telegram ID</label>
        <input type="number" [value]="editData().telegram_id"
          (input)="onEditFieldChange('telegram_id', $any($event.target).value)" />
      </div>

      <div class="form-group">
        <label>Contrase침a actual</label>
        <div class="password-field">
          <input [type]="showOldPassword() ? 'text' : 'password'" placeholder="Obligatoria para cambiar la contrase침a"
            [value]="editData().oldPassword" (input)="onEditFieldChange('oldPassword', $any($event.target).value)" />
          <button type="button" class="toggle-eye" (click)="toggleOldPasswordVisibility()">
            @if (showOldPassword()) { Ocultar } @else { Ver }
          </button>
        </div>
      </div>

      <div class="form-group">
        <label>Nueva contrase침a</label>
        <div class="password-field">
          <input [type]="showNewPassword1() ? 'text' : 'password'" placeholder="Introduce la nueva contrase침a"
            [value]="editData().newPassword1" (input)="onEditFieldChange('newPassword1', $any($event.target).value)" />
          <button type="button" class="toggle-eye" (click)="toggleNewPassword1Visibility()">
            @if (showNewPassword1()) { Ocultar } @else { Ver }
          </button>
        </div>
      </div>

      <div class="form-group">
        <label>Repite la nueva contrase침a</label>
        <div class="password-field">
          <input [type]="showNewPassword2() ? 'text' : 'password'" placeholder="Repite la nueva contrase침a"
            [value]="editData().newPassword2" (input)="onEditFieldChange('newPassword2', $any($event.target).value)" />
          <button type="button" class="toggle-eye" (click)="toggleNewPassword2Visibility()">
            @if (showNewPassword2()) { Ocultar } @else { Ver }
          </button>
        </div>
      </div>

      <div class="modal-actions">
        <button class="secondary" (click)="closeEditModal()">Cancelar</button>
        <button class="primary" [disabled]="editLoading()" (click)="saveUserEdits()">
          @if (editLoading()) { Guardando... } @else { Guardar cambios }
        </button>
      </div>
    </div>
  </div>
  }
</div>