<div class="dashboardContainer">
    <!-- Mobile Sidebar Overlay -->
    @if (isSidebarOpen()) {
    <div class="sidebarOverlay" (click)="closeSidebar()"></div>
    }

    <div class="sidebar" [class.open]="isSidebarOpen()">
        <div class="header">
            <h1>Centro de Archivos</h1>
            <button class="closeSidebarBtn icon-only" (click)="closeSidebar()">
                <img src="assets/icons/boton-x.png" alt="Cerrar" class="icon-close" />
                <span class="visually-hidden">Cerrar</span>
            </button>
        </div>
        <nav class="scopeNav">
            <button class="scopeBtn" [class.active]="activeScope() === 'mine'" (click)="setActiveScope('mine')">
                Mi unidad
            </button>
            <button class="scopeBtn" [class.active]="activeScope() === 'shared'" (click)="setActiveScope('shared')">
                Compartidos
            </button>
            <button class="scopeBtn" [class.active]="activeScope() === 'sent'" (click)="setActiveScope('sent')">
                Enviados
            </button>
        </nav>
        @if (user()) {
        <app-friend-list [refreshTrigger]="friendRefreshTrigger()"
            (selectFriend)="handleSelectFriend($event)"></app-friend-list>
        }
    </div>

    <div class="mainContent">
        <header class="header" style="justify-content: space-between">
            <button class="menuBtn" (click)="toggleSidebar()">☰</button>

            <div style="display: flex; align-items: center; gap: 1rem; margin-left: auto">
                @if (user()) {
                <app-notification-center (accepted)="handleFriendAccepted()"></app-notification-center>
                }
                <app-user-icon [user]="user()" (logout)="handleLogout()"></app-user-icon>
            </div>
        </header>

        @if (loading()) {
        <div class="dashboardContainer" style="display: flex; justify-content: center; align-items: center">
            <div class="spinner">Cargando...</div>
        </div>
        } @else if (!user()) {
        <div class="loginPrompt">
            <h2>Inicia sesión para compartir archivos</h2>
            <p>Necesitas una cuenta para enviar y recibir archivos con tus amigos.</p>
            <button class="primaryBtn" style="margin-top: 1.5rem"
                onclick="window.location.href='/login?redirect=/fileshare&title=Centro de Archivos'">
                Iniciar Sesión
            </button>
        </div>
        } @else {
        <div class="tabs">
            <button class="tab" [class.active]="activeTab() === 'files'" (click)="setActiveTab('files')">
                Mis Archivos
                @if (unreadCount() > 0) {
                <span class="tabNotificationDot"></span>
                }
            </button>
            <button class="tab" [class.active]="activeTab() === 'upload'" (click)="setActiveTab('upload')">
                Enviar Archivo
            </button>
        </div>

        <div class="contentArea">
            <div class="tabContent">
                @if (activeTab() === 'files') {
                <app-incoming-files [user]="user()" [refreshTrigger]="refreshTrigger()" [scope]="activeScope()"
                    [forceResetCount]="forceResetCount()"
                    (unreadCountChange)="onUnreadCountChange($event)"
                    (openUpload)="setActiveTab('upload')"></app-incoming-files>
                }
                @if (activeTab() === 'upload') {
                <app-file-upload [user]="user()" [selectedRecipient]="selectedRecipient()"
                    (uploadSuccess)="handleUploadSuccess()"
                    (recipientChange)="onRecipientChange($event)"></app-file-upload>
                }
            </div>
        </div>
        }
    </div>
</div>
