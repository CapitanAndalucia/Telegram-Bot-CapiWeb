<div class="comp-overlay" (click)="onBackdropClick($event)">
    <div class="comp-modal">
        <div class="modal-header">
            <h3>Compartir {{ type === 'file' ? 'Archivo' : 'Carpeta' }}</h3>
            <button class="close-btn" (click)="close.emit()">√ó</button>
        </div>

        <div class="modal-body">
            <p class="item-name">
                <span class="icon">{{ type === 'file' ? 'üìÑ' : 'üìÅ' }}</span>
                {{ type === 'file' ? $any(item).filename : $any(item).name }}
            </p>

            <div class="search-section">
                <input type="text" [(ngModel)]="searchQuery" (ngModelChange)="onSearch()"
                    placeholder="Buscar usuario..." class="search-input">

                @if (searchResults().length > 0) {
                <div class="search-results">
                    @for (user of searchResults(); track user.id) {
                    <div class="user-item" (click)="selectUser(user)">
                        <div class="avatar">{{ user.username.charAt(0).toUpperCase() }}</div>
                        <span class="username">{{ user.username }}</span>
                    </div>
                    }
                </div>
                }
            </div>

            <div class="friends-section">
                <h4>Amigos sugeridos</h4>
                <div class="friends-list">
                    @for (friend of friends(); track friend.id) {
                    <div class="friend-chip" [class.selected]="selectedUser()?.id === friend.id"
                        (click)="selectUser(friend)">
                        <div class="avatar-small">{{ friend.username.charAt(0).toUpperCase() }}</div>
                        <span>{{ friend.username }}</span>
                    </div>
                    }
                    @if (friends().length === 0) {
                    <p class="no-friends">No tienes amigos agregados a√∫n.</p>
                    }
                </div>
            </div>

            @if (selectedUser()) {
            <div class="selected-user-summary">
                Compartir con: <strong>{{ selectedUser().username }}</strong>
            </div>
            }

        </div>

        <div class="modal-footer">
            <button class="cancel-btn" (click)="close.emit()">Cancelar</button>
            <button class="share-action-btn" [disabled]="!selectedUser() || isSharing()" (click)="share()">
                {{ isSharing() ? 'Compartiendo...' : 'Compartir' }}
            </button>
        </div>
    </div>
</div>