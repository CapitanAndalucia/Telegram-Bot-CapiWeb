<div class="fixed inset-0 z-[5000] bg-black/[0.65] flex flex-col transition-opacity duration-200"
    [class.opacity-0]="isClosing || isOpening">
    <!-- Header -->
    <div class="flex items-center justify-between px-4 py-3 bg-black/40 backdrop-blur-sm z-50">
        <!-- Left: Back & File Info -->
        <div class="flex items-center gap-4 min-w-0 flex-1">
            <button class="p-2 rounded-full hover:bg-white/10 text-white transition-colors" (click)="onClose()">
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" />
                </svg>
            </button>
            <div class="flex items-center gap-3 min-w-0">
                <!-- Icon based on type -->
                @if (isImage) {
                <svg class="w-6 h-6 text-red-500 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z" />
                </svg>
                } @else if (isVideo) {
                <svg class="w-6 h-6 text-red-500 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M18 4l2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4h-4z" />
                </svg>
                } @else {
                <svg class="w-6 h-6 text-blue-400 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z" />
                </svg>
                }
                <span class="text-white font-medium truncate text-lg">{{ file().filename }}</span>
            </div>
        </div>

        <!-- Center: Open With (Hidden) -->
        <div class="hidden md:flex items-center justify-center flex-1"></div>

        <!-- Right: Actions -->
        <div class="flex items-center justify-end gap-2 flex-1">

            <button class="p-2 rounded-full hover:bg-white/10 text-white transition-colors" (click)="onDownload()"
                title="Descargar">
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z" />
                </svg>
            </button>
            <button class="p-2 rounded-full hover:bg-white/10 text-white transition-colors"
                (click)="showMoreMenu = !showMoreMenu" title="Más acciones">
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" />
                </svg>
            </button>

            <!-- Share Button -->
            <button
                class="ml-2 flex items-center gap-2 px-4 py-1.5 bg-blue-500 hover:bg-blue-600 rounded-full text-sm font-medium text-white transition-colors"
                (click)="onShare()">
                <svg class="w-4 h-4 ml-[-4px]" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z" />
                </svg>
                Compartir
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="flex-1 flex items-center justify-center p-4 overflow-hidden relative" (click)="onClose()">
        <div class="relative max-w-full max-h-full flex items-center justify-center" (click)="$event.stopPropagation()">
            @if (isImage) {
            <img [src]="downloadUrl" [alt]="file().filename"
                class="max-w-full max-h-[85vh] object-contain shadow-2xl transition-transform duration-200"
                [style.transform]="'scale(' + zoomLevel + ')'" />
            } @else if (isVideo) {
            <video [src]="streamUrl" class="max-w-full max-h-[85vh] shadow-2xl" controls playsinline autoplay>
                Tu navegador no soporta la reproducción de video.
            </video>
            } @else {
            <div class="flex flex-col items-center gap-4 p-12 bg-neutral-900 rounded-xl border border-neutral-800">
                <svg class="w-24 h-24 text-gray-500" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z" />
                </svg>
                <div class="text-center">
                    <p class="text-white text-lg font-medium">Vista previa no disponible</p>
                    <p class="text-gray-400 text-sm mt-1">{{ (file().size / 1024).toFixed(1) }} KB</p>
                </div>
                <button
                    class="mt-4 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium"
                    (click)="onDownload()">
                    Descargar archivo
                </button>
            </div>
            }
        </div>
    </div>

    <!-- Floating Zoom Controls -->
    @if (isImage) {
    <div
        class="absolute bottom-6 left-1/2 transform -translate-x-1/2 flex items-center gap-1 px-2 py-1.5 bg-neutral-900/90 backdrop-blur-md rounded-full border border-white/10 shadow-lg z-50">
        <button class="p-1.5 rounded-full hover:bg-white/10 text-white transition-colors" (click)="zoomOut()"
            title="Reducir">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 13H5v-2h14v2z" />
            </svg>
        </button>
        <span class="px-2 text-sm font-medium text-white min-w-[3rem] text-center">{{ (zoomLevel * 100).toFixed(0)
            }}%</span>
        <button class="p-1.5 rounded-full hover:bg-white/10 text-white transition-colors" (click)="zoomIn()"
            title="Ampliar">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
            </svg>
        </button>
    </div>
    }
</div>