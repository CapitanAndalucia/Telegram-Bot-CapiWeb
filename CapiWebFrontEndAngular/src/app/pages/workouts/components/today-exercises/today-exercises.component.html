<div class="fixed inset-0 bg-[#112218] font-workout text-white antialiased flex flex-col overflow-hidden">
    <!-- Main Content Wrapper -->
    <div class="flex flex-col h-full grow overflow-y-auto pb-24">
        <!-- Top App Bar -->
        <header class="sticky top-0 z-50 bg-[#112218]/95 backdrop-blur-md px-4 py-2 border-b border-white/5">
            <div class="flex items-center h-12 justify-between">
                <button (click)="goBack()"
                    class="text-white flex size-12 shrink-0 items-center justify-center rounded-full hover:bg-white/10 transition-colors">
                    <span class="material-symbols-outlined" style="font-size: 24px;">arrow_back</span>
                </button>
                <div class="flex w-12 items-center justify-end">
                    <button
                        class="text-[#13ec6a] hover:text-[#0fb650] text-base font-bold leading-normal tracking-wide shrink-0 transition-colors">Editar</button>
                </div>
            </div>
            <div class="pb-2">
                <h1 class="text-white tracking-tight text-[32px] font-bold leading-tight">Ejercicios de Hoy</h1>
            </div>
        </header>

        <!-- Loading State -->
        @if (loading()) {
        <div class="flex justify-center py-12">
            <div class="w-8 h-8 border-2 border-[#13ec6a] border-t-transparent rounded-full animate-spin"></div>
        </div>
        }

        @if (!loading()) {
        <!-- Timer Section -->
        <section class="mt-4 px-4">
            <div class="flex gap-4 py-4">
                <!-- Hours -->
                <div class="flex grow basis-0 flex-col items-center gap-2">
                    <div
                        class="flex w-full aspect-square max-w-[80px] sm:max-w-none sm:h-20 items-center justify-center rounded-xl bg-[#1d3627] shadow-sm border border-white/5">
                        <span class="text-white text-3xl font-bold tracking-tight">{{ padZero(hours()) }}</span>
                    </div>
                    <span class="text-slate-400 text-xs font-medium uppercase tracking-wider">Horas</span>
                </div>
                <div class="flex items-center pb-8 text-slate-600 font-bold text-2xl">:</div>
                <!-- Minutes -->
                <div class="flex grow basis-0 flex-col items-center gap-2">
                    <div
                        class="flex w-full aspect-square max-w-[80px] sm:max-w-none sm:h-20 items-center justify-center rounded-xl bg-[#1d3627] shadow-sm border border-white/5">
                        <span class="text-white text-3xl font-bold tracking-tight">{{ padZero(minutes()) }}</span>
                    </div>
                    <span class="text-slate-400 text-xs font-medium uppercase tracking-wider">Minutos</span>
                </div>
                <div class="flex items-center pb-8 text-slate-600 font-bold text-2xl">:</div>
                <!-- Seconds -->
                <div class="flex grow basis-0 flex-col items-center gap-2">
                    <div
                        class="flex w-full aspect-square max-w-[80px] sm:max-w-none sm:h-20 items-center justify-center rounded-xl bg-[#13ec6a] text-[#102217] shadow-[0_0_15px_rgba(19,236,106,0.3)]">
                        <span class="text-[#102217] text-3xl font-bold tracking-tight">{{ padZero(seconds()) }}</span>
                    </div>
                    <span class="text-slate-400 text-xs font-medium uppercase tracking-wider">Segundos</span>
                </div>
            </div>
        </section>

        <!-- Progress Bar -->
        <section class="px-6 mb-8">
            <div class="flex flex-col gap-3">
                <div class="flex gap-6 justify-between items-end">
                    <p class="text-white text-base font-semibold leading-normal">{{ dayTitle() }}</p>
                    <p class="text-[#13ec6a] text-sm font-bold leading-normal">{{ progressPercent() }}% Completado</p>
                </div>
                <div class="rounded-full bg-[#1d3627] h-3 w-full overflow-hidden">
                    <div class="h-full rounded-full bg-[#13ec6a] shadow-[0_0_10px_rgba(19,236,106,0.5)] transition-all duration-500 ease-out"
                        [style.width.%]="progressPercent()">
                    </div>
                </div>
                <p class="text-slate-400 text-sm font-medium leading-normal">
                    {{ completedCount() }} de {{ totalCount() }} ejercicios completados
                </p>
            </div>
        </section>

        <!-- Exercise List -->
        <section class="flex flex-col gap-3 px-4 pb-4">
            @for (group of exercises(); track group.parent.id) {
            <div (click)="toggleExercise(group)" (touchstart)="onTouchStart($event, group.parent.id)"
                (touchmove)="onTouchMove($event, group.parent.id)" (touchend)="onTouchEnd($event, group)"
                class="group relative flex items-center justify-between gap-4 rounded-xl bg-[#1d3627] p-4 shadow-sm transition-all active:scale-[0.99] cursor-pointer overflow-hidden select-none"
                [class]="group.isCompleted ? 'border border-[#13ec6a]/20' : group.isActive ? 'border-l-4 border-l-[#13ec6a] shadow-lg ring-1 ring-white/5' : 'border border-transparent hover:border-white/5 opacity-80'">

                <!-- Content Wrapper (Carousel) -->
                <div class="flex flex-col flex-1 min-w-0 overflow-hidden">
                    <!-- Carousel Track -->
                    <div class="flex transition-transform will-change-transform" [style.transform]="getTransform(group)"
                        [class.duration-300]="!isSwiping(group.parent.id)"
                        [class.ease-out]="!isSwiping(group.parent.id)" style="width: 100%;">

                        @for (version of group.versions; track version.id) {
                        <div class="w-full shrink-0 flex items-center gap-4">
                            <!-- Icon -->
                            <div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-full"
                                [class]="group.isCompleted ? 'bg-[#13ec6a]/20 text-[#13ec6a]' : group.isActive ? 'bg-white/10 text-white' : 'bg-white/5 text-slate-500'">
                                <span class="material-symbols-outlined">{{ getExerciseIcon(version) }}</span>
                            </div>

                            <!-- Info -->
                            <div class="flex flex-col min-w-0">
                                <div class="flex items-center gap-2">
                                    <p class="text-lg font-medium leading-normal truncate"
                                        [class]="group.isCompleted ? 'text-slate-400 line-through' : group.isActive ? 'text-white font-bold' : 'text-slate-200'">
                                        {{ version.exercise_detail.name }}
                                    </p>
                                </div>
                                <p class="text-sm font-normal"
                                    [class]="group.isCompleted ? 'text-slate-500' : 'text-slate-400'">
                                    {{ formatExerciseInfo(version) }}
                                </p>
                            </div>
                        </div>
                        }
                    </div>

                    <!-- Static Variant Indicator Dots -->
                    @if (group.hasVariants && !group.isCompleted) {
                    <div class="flex gap-1 mt-1.5 pl-[4rem]">
                        @for (v of group.versions; track v.id) {
                        <div class="h-1 rounded-full transition-all duration-300" [class.w-4]="v.id === group.active.id"
                            [class.bg-[#13ec6a]]="v.id === group.active.id" [class.w-1]="v.id !== group.active.id"
                            [class.bg-white/20]="v.id !== group.active.id">
                        </div>
                        }
                    </div>
                    }
                </div>

                <!-- Checkbox -->
                <div class="shrink-0 relative" (click)="toggleExercise(group); $event.stopPropagation()">
                    <input type="checkbox" [checked]="group.isCompleted"
                        class="peer h-8 w-8 cursor-pointer appearance-none rounded-full border-2 transition-all focus:ring-0 focus:ring-offset-0"
                        [class]="group.isCompleted ? 'border-[#13ec6a] bg-[#13ec6a]' : 'border-white/20 bg-transparent hover:border-[#13ec6a]'" />
                    <span
                        class="material-symbols-outlined absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none text-[#102217] text-xl font-bold transition-opacity"
                        [class]="group.isCompleted ? 'opacity-100' : 'opacity-0'">
                        check
                    </span>
                </div>
            </div>
            }
        </section>

        <!-- Bottom Spacing -->
        <div class="h-24"></div>
        }
    </div>

    <!-- Sticky Footer Button -->
    <div
        class="fixed bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-[#112218] via-[#112218] to-transparent z-40 pb-6 pt-12">
        <button (click)="finishWorkout()"
            class="w-full h-14 bg-[#13ec6a] hover:bg-[#0fb650] text-[#102217] text-lg font-bold rounded-full shadow-[0_4px_20px_rgba(19,236,106,0.3)] transition-all transform active:scale-[0.98] flex items-center justify-center gap-2">
            <span>Finalizar Entrenamiento</span>
            <span class="material-symbols-outlined">flag</span>
        </button>
    </div>
</div>