<div class="fixed inset-0 bg-[#102217] font-workout flex flex-col antialiased text-white overflow-hidden">
    <!-- Header -->
    <div class="sticky top-0 z-50 bg-[#102217]/95 backdrop-blur-md px-4 pt-12 pb-2">
        <div class="flex items-center justify-between">
            <button (click)="close()"
                class="flex h-10 w-10 items-center justify-center rounded-full bg-transparent text-white hover:bg-white/10 transition-colors">
                <span class="material-symbols-outlined" style="font-size: 28px;">close</span>
            </button>
            <h2 class="flex-1 text-center text-lg font-bold tracking-tight text-white">
                @if (variantParentId()) {
                Añadir Alternativo
                } @else if (isUpdateMode()) {
                Modificar Ejercicio
                } @else {
                Añadir Ejercicio
                }
            </h2>
            <!-- Buttons removed as requested -->
            <div class="w-10"></div> <!-- Spacer to center title -->

        </div>

        <!-- Variant mode indicator -->
        @if (variantParentId()) {
        <div class="mt-2 px-3 py-2 rounded-xl bg-[#13ec6a]/10 border border-[#13ec6a]/30">
            <p class="text-sm text-[#13ec6a]">
                <span class="material-symbols-outlined align-middle text-sm mr-1">link</span>
                Alternativo para: <strong>{{ variantParentName() }}</strong>
            </p>
        </div>
        }
    </div>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col gap-6 px-4 pb-24 overflow-y-auto">
        <!-- Exercise Name Input -->
        <div class="mt-4">
            <label class="block text-sm font-medium text-[#9cacba] uppercase tracking-wider mb-2 ml-1">Nombre del
                Ejercicio</label>
            <div
                class="relative flex items-center h-14 w-full rounded-full bg-[#1d3627] shadow-sm ring-1 ring-white/5 group focus-within:ring-2 focus-within:ring-[#13ec6a] transition-all">
                <div
                    class="flex h-full w-12 items-center justify-center pl-2 text-gray-400 group-focus-within:text-[#13ec6a]">
                    <span class="material-symbols-outlined">fitness_center</span>
                </div>
                <input type="text" [value]="exerciseName()" (input)="updateExerciseName($event)"
                    placeholder="ej: Sentadilla, Flexiones..."
                    class="h-full w-full border-none bg-transparent px-2 text-base text-white placeholder-gray-400 focus:outline-none focus:ring-0" />
                @if (exerciseName()) {
                <button (click)="clearName()"
                    class="flex h-full w-12 items-center justify-center pr-2 text-gray-400 hover:text-[#13ec6a]">
                    <span class="material-symbols-outlined" style="font-size: 20px;">cancel</span>
                </button>
                }
            </div>

            <!-- Quick Suggestions (clickable) -->
            <div class="mt-3 flex gap-2 overflow-x-auto no-scrollbar pb-1">
                @for (suggestion of filteredSuggestions(); track suggestion.id) {
                <button (click)="selectSuggestion(suggestion)"
                    class="flex-shrink-0 cursor-pointer rounded-full px-4 py-2 text-sm font-medium transition-colors bg-[#1d3627] border border-[#3d5a4c] text-white hover:border-[#13ec6a]/50">
                    {{ suggestion.name }}
                </button>
                }
            </div>
        </div>

        <!-- Form appears when exercise name is entered -->
        @if (exerciseName().trim().length > 0) {
        <!-- Exercise Preview Card -->
        <div class="rounded-2xl bg-[#1d3627] p-4 shadow-sm ring-1 ring-white/5">
            <div class="flex gap-4 items-center">
                <!-- Icon Button -->
                <button (click)="openIconPicker()"
                    class="h-16 w-16 flex-shrink-0 overflow-hidden rounded-xl bg-[#234832] relative flex items-center justify-center border-2 border-dashed border-[#3d5a4c] hover:border-[#13ec6a] transition-colors">
                    @if (selectedIcon().includes('/')) {
                    <img [src]="selectedIcon()" class="w-8 h-8 object-contain filter-green">
                    } @else {
                    <span class="material-symbols-outlined text-[#13ec6a]" style="font-size: 32px;">{{ selectedIcon()
                        }}</span>
                    }
                </button>
                <div class="flex flex-col justify-center flex-1">
                    <h3 class="text-lg font-bold text-white">{{ exerciseName() }}</h3>
                    <p class="text-sm text-gray-400">{{ selectedCategory() }} • {{ selectedEquipment() }}</p>
                </div>
                <button (click)="openCategoryPicker()" class="text-[#13ec6a] text-sm font-medium">Editar</button>
            </div>
        </div>

        <!-- Exercise Images Section -->
        <div>
            <label class="block text-sm font-medium text-[#9cacba] uppercase tracking-wider mb-3 ml-1">
                Imágenes del Ejercicio
            </label>

            <!-- Hidden file input -->
            <input type="file" #exerciseImagesInput multiple (change)="onImagesSelected($event)" class="hidden" />

            <!-- Image Grid -->
            <div class="flex gap-3 overflow-x-auto no-scrollbar pb-2">
                <!-- Existing DB images -->
                @for (img of existingImages(); track img.id) {
                <div class="relative shrink-0 w-24 h-24 rounded-xl overflow-hidden bg-[#1d3627]">
                    <img [src]="img.url" alt="Stored Image" class="w-full h-full object-cover" />
                    <button (click)="removeExistingImage(img.id)"
                        class="absolute top-1 right-1 flex size-6 items-center justify-center rounded-full bg-black/60 text-white hover:bg-red-500 transition-colors">
                        <span class="material-symbols-outlined" style="font-size: 14px;">close</span>
                    </button>
                </div>
                }

                <!-- New Upload Preview -->
                @for (image of exerciseImages(); track $index) {
                <div class="relative shrink-0 w-24 h-24 rounded-xl overflow-hidden bg-[#1d3627]">
                    <img [src]="image.preview" alt="Preview" class="w-full h-full object-cover" />
                    <button (click)="removeImage($index)"
                        class="absolute top-1 right-1 flex size-6 items-center justify-center rounded-full bg-black/60 text-white hover:bg-red-500 transition-colors">
                        <span class="material-symbols-outlined" style="font-size: 14px;">close</span>
                    </button>
                </div>
                }

                <!-- Add image button -->
                <button (click)="openImagePicker()"
                    class="shrink-0 w-24 h-24 flex flex-col items-center justify-center gap-1 rounded-xl border-2 border-dashed border-[#3d5a4c] text-[#9cacba] hover:border-[#13ec6a] hover:text-[#13ec6a] hover:bg-[#13ec6a]/5 transition-all">
                    <span class="material-symbols-outlined" style="font-size: 24px;">add_photo_alternate</span>
                    <span class="text-xs font-medium">Añadir</span>
                </button>
            </div>
            <p class="text-xs text-[#9cacba]/70 mt-2 ml-1">Las imágenes se optimizarán automáticamente</p>
        </div>

        <div class="h-px w-full bg-[#3d5a4c]"></div>

        <!-- Cardio Toggle -->
        <div class="flex items-center justify-between p-4 rounded-2xl bg-[#1d3627] ring-1 ring-white/5">
            <div class="flex items-center gap-3">
                <span class="material-symbols-outlined text-[#13ec6a]" style="font-size: 24px;">directions_run</span>
                <div>
                    <span class="text-white font-medium">Ejercicio de Cardio</span>
                    <p class="text-xs text-[#9cacba]">Tiempo, distancia y resistencia</p>
                </div>
            </div>
            <button (click)="toggleCardio()" class="relative w-14 h-8 rounded-full transition-colors duration-200"
                [class]="isCardio() ? 'bg-[#13ec6a]' : 'bg-[#3d5a4c]'">
                <span
                    class="absolute top-1 left-1 w-6 h-6 rounded-full bg-white shadow transition-transform duration-200"
                    [class.translate-x-6]="isCardio()"></span>
            </button>
        </div>

        <!-- CARDIO MODE FIELDS -->
        @if (isCardio()) {
        <!-- Duration Counter -->
        <div>
            <div class="mb-3 flex items-center justify-between">
                <label class="text-base font-semibold text-white">Duración</label>
                <span class="text-xs font-medium uppercase tracking-wider text-[#13ec6a]">Minutos</span>
            </div>
            <div class="relative">
                <input type="number" inputmode="numeric" [value]="duration()" (input)="updateDuration($event)"
                    placeholder="0"
                    class="h-16 w-full rounded-2xl border-none bg-[#1d3627] pl-4 pr-16 text-center text-2xl font-bold text-white shadow-sm ring-1 ring-white/5 focus:ring-2 focus:ring-[#13ec6a] placeholder-gray-600" />
                <span class="absolute right-4 top-1/2 -translate-y-1/2 text-[#9cacba]">min</span>
            </div>
            <!-- Quick Chips -->
            <div class="mt-3 flex gap-2 overflow-x-auto no-scrollbar">
                @for (dur of quickDurations; track dur) {
                <button (click)="setQuickDuration(dur)"
                    class="rounded-full px-3 py-1 text-xs font-medium border transition-colors" [class]="duration() === dur 
                                ? 'bg-[#13ec6a]/20 border-[#13ec6a]/20 text-[#13ec6a]' 
                                : 'bg-[#1d3627] border-[#3d5a4c] text-gray-300'">
                    {{ dur }} min
                </button>
                }
            </div>
        </div>

        <!-- Distance & Resistance Grid -->
        <div class="grid grid-cols-2 gap-4">
            <!-- Distance -->
            <div>
                <label class="mb-3 block text-base font-semibold text-white">Distancia <span
                        class="text-sm font-normal text-gray-500">(km)</span></label>
                <div class="relative">
                    <input type="number" inputmode="decimal" [value]="distance()" (input)="updateDistance($event)"
                        placeholder="0"
                        class="h-16 w-full rounded-2xl border-none bg-[#1d3627] pl-4 pr-4 text-center text-2xl font-bold text-white shadow-sm ring-1 ring-white/5 focus:ring-2 focus:ring-[#13ec6a] placeholder-gray-600" />
                </div>
                <!-- Quick Chips -->
                <div class="mt-3 flex gap-2 overflow-x-auto no-scrollbar">
                    @for (dist of quickDistances; track dist) {
                    <button (click)="setQuickDistance(dist)"
                        class="rounded-full px-3 py-1 text-xs font-medium border transition-colors" [class]="distance() === dist 
                                    ? 'bg-[#13ec6a]/20 border-[#13ec6a]/20 text-[#13ec6a]' 
                                    : 'bg-[#1d3627] border-[#3d5a4c] text-gray-300'">
                        {{ dist }} km
                    </button>
                    }
                </div>
            </div>

            <!-- Resistance -->
            <div>
                <label class="mb-3 block text-base font-semibold text-white">Resistencia <span
                        class="text-sm font-normal text-gray-500">(1-20)</span></label>
                <div
                    class="flex h-16 w-full items-center justify-between rounded-2xl bg-[#1d3627] p-2 shadow-sm ring-1 ring-white/5">
                    <button (click)="decrementResistance()"
                        class="flex h-12 w-12 items-center justify-center rounded-full bg-[#112218] text-white hover:bg-[#234832] transition-colors">
                        <span class="material-symbols-outlined">remove</span>
                    </button>
                    <span class="text-2xl font-bold text-white">{{ resistance() }}</span>
                    <button (click)="incrementResistance()"
                        class="flex h-12 w-12 items-center justify-center rounded-full bg-[#13ec6a] text-[#102217] hover:bg-[#0fb650] transition-colors">
                        <span class="material-symbols-outlined">add</span>
                    </button>
                </div>
            </div>
        </div>
        } @else {
        <!-- STRENGTH MODE FIELDS -->
        <!-- Sets Counter -->
        <div>
            <div class="mb-3 flex items-center justify-between">
                <label class="text-base font-semibold text-white">Series</label>
                <span class="text-xs font-medium uppercase tracking-wider text-[#13ec6a]">Objetivo</span>
            </div>
            <div
                class="flex h-16 w-full items-center justify-between rounded-full bg-[#1d3627] p-2 shadow-sm ring-1 ring-white/5">
                <button (click)="decrementSets()"
                    class="flex h-12 w-12 items-center justify-center rounded-full bg-[#112218] text-white hover:bg-[#234832] transition-colors">
                    <span class="material-symbols-outlined">remove</span>
                </button>
                <span class="text-2xl font-bold text-white">{{ sets() }}</span>
                <button (click)="incrementSets()"
                    class="flex h-12 w-12 items-center justify-center rounded-full bg-[#13ec6a] text-[#102217] hover:bg-[#0fb650] transition-colors">
                    <span class="material-symbols-outlined">add</span>
                </button>
            </div>
        </div>

        <!-- Reps & Weight Grid -->
        <div class="grid grid-cols-2 gap-4">
            <!-- Reps -->
            <div>
                <label class="mb-3 block text-base font-semibold text-white">Reps</label>
                <div class="relative">
                    <input type="number" inputmode="numeric" [value]="reps()" (input)="updateReps($event)"
                        placeholder="0"
                        class="h-16 w-full rounded-2xl border-none bg-[#1d3627] pl-4 pr-4 text-center text-2xl font-bold text-white shadow-sm ring-1 ring-white/5 focus:ring-2 focus:ring-[#13ec6a] placeholder-gray-600" />
                </div>
                <!-- Quick Chips -->
                <div class="mt-3 flex gap-2 overflow-x-auto no-scrollbar">
                    @for (rep of quickReps; track rep) {
                    <button (click)="setQuickReps(rep)"
                        class="rounded-full px-3 py-1 text-xs font-medium border transition-colors" [class]="reps() === rep 
                                    ? 'bg-[#13ec6a]/20 border-[#13ec6a]/20 text-[#13ec6a]' 
                                    : 'bg-[#1d3627] border-[#3d5a4c] text-gray-300'">
                        {{ rep }}
                    </button>
                    }
                </div>
            </div>

            <!-- Weight -->
            <div>
                <label class="mb-3 block text-base font-semibold text-white">Peso <span
                        class="text-sm font-normal text-gray-500">(kg)</span></label>
                <div class="relative">
                    <input type="number" inputmode="decimal" [value]="weight()" (input)="updateWeight($event)"
                        placeholder="0"
                        class="h-16 w-full rounded-2xl border-none bg-[#1d3627] pl-4 pr-4 text-center text-2xl font-bold text-white shadow-sm ring-1 ring-white/5 focus:ring-2 focus:ring-[#13ec6a] placeholder-gray-600" />
                </div>
                <!-- Quick Chips -->
                <div class="mt-3 flex gap-2 overflow-x-auto no-scrollbar">
                    @for (inc of quickWeightIncrements; track inc) {
                    <button (click)="addWeight(inc)"
                        class="rounded-full bg-[#1d3627] border border-[#3d5a4c] px-3 py-1 text-xs font-medium text-gray-300 hover:border-[#13ec6a]/50 transition-colors">
                        +{{ inc }}
                    </button>
                    }
                </div>
            </div>
        </div>
        }

        <!-- Notes (common to both modes) -->
        <div>
            <label class="mb-3 block text-base font-semibold text-white">Notas</label>
            <textarea [value]="notes()" (input)="updateNotes($event)" placeholder="Añade notas sobre forma, RPE, etc..."
                rows="3"
                class="w-full resize-none rounded-2xl border-none bg-[#1d3627] p-4 text-base text-white shadow-sm ring-1 ring-white/5 focus:ring-2 focus:ring-[#13ec6a] placeholder-gray-500">
                </textarea>
        </div>

        <div class="h-px w-full bg-[#3d5a4c]"></div>

        <!-- Variant Section -->
        <!-- Variant Section (Hidden if creating a variant) -->
        @if (!variantParentId()) {
        <div>
            <button (click)="toggleVariantSection()" class="w-full flex items-center justify-between py-3 text-left">
                <div class="flex items-center gap-2">
                    <span class="material-symbols-outlined text-[#13ec6a]" style="font-size: 20px;">swap_horiz</span>
                    <span class="text-base font-semibold text-white">Versión Alternativa</span>
                    <span class="text-xs text-[#9cacba]">(opcional)</span>
                </div>
                <span class="material-symbols-outlined text-[#9cacba] transition-transform"
                    [class.rotate-180]="showVariantSection()">expand_more</span>
            </button>

            @if (showVariantSection()) {
            <div class="space-y-3 mt-2">
                <p class="text-sm text-[#9cacba]">
                    Añade una versión alternativa del ejercicio para cuando no esté disponible el equipo principal.
                </p>

                <!-- Existing Variants -->
                @if (variants().length > 0) {
                <div class="space-y-2">
                    @for (variant of variants(); track $index) {
                    <div class="flex items-center gap-3 p-3 rounded-xl bg-[#1d3627] border border-[#3d5a4c]">
                        <span class="size-10 rounded-lg bg-[#13ec6a]/20 flex items-center justify-center">
                            @if (variant.icon && variant.icon.includes('/')) {
                            <img [src]="variant.icon" class="w-5 h-5 object-contain filter-green">
                            } @else {
                            <span class="material-symbols-outlined text-[#13ec6a]" style="font-size: 20px;">{{
                                variant.icon || 'fitness_center' }}</span>
                            }
                        </span>
                        <div class="flex-1">
                            <p class="text-white font-medium">{{ variant.name }}</p>
                            <p class="text-slate-400 text-xs">{{ variant.sets }} series • {{ variant.reps }} reps</p>
                        </div>
                        <button (click)="removeVariant($index)"
                            class="size-8 flex items-center justify-center rounded-full bg-red-500/10 text-red-500 hover:bg-red-500 hover:text-white transition-colors">
                            <span class="material-symbols-outlined" style="font-size: 16px;">close</span>
                        </button>
                    </div>
                    }
                </div>
                }

                <!-- Add Variant Button -->
                <button (click)="openVariantPicker()"
                    class="w-full flex items-center justify-center gap-2 py-3 px-4 rounded-xl border-2 border-dashed border-[#13ec6a]/40 text-[#13ec6a] hover:bg-[#13ec6a]/10 transition-colors">
                    <span class="material-symbols-outlined" style="font-size: 20px;">add_circle_outline</span>
                    <span class="font-medium">Añadir versión alternativa</span>
                </button>
            </div>
            }
        </div>
        }
        }
    </main>

    <!-- Sticky Footer Action -->
    <div
        class="fixed bottom-0 left-0 right-0 bg-gradient-to-t from-[#102217] via-[#102217] to-transparent pb-8 pt-12 px-4 z-40 pointer-events-none">
        <button (click)="save()" [disabled]="!canSave()"
            class="pointer-events-auto flex w-full h-14 items-center justify-center gap-2 rounded-full text-lg font-bold shadow-[0_4px_20px_rgba(19,236,106,0.3)] transition-all active:scale-[0.98]"
            [class]="canSave() ? 'bg-[#13ec6a] text-[#102217] hover:bg-[#0fb650]' : 'bg-[#1d3627] text-[#9cacba] cursor-not-allowed'">
            <span class="material-symbols-outlined">{{ isUpdateMode() ? 'save' : 'add_circle' }}</span>
            {{ variantParentId() ? 'Guardar ejercicio alternativo' : (isUpdateMode() ? 'Guardar y Salir' : 'Añadir a la
            Rutina') }}
        </button>
    </div>

    <!-- Modals -->
    <app-confirm-modal [isOpen]="showDeleteVariantModal()" title="¿Eliminar variante?"
        message="Esta acción no se puede deshacer. ¿Seguro que quieres eliminar esta variante?" confirmText="Eliminar"
        cancelText="Cancelar" (confirm)="confirmDeleteVariant()" (cancel)="cancelDeleteVariant()">
    </app-confirm-modal>

    <!-- Icon Picker Modal -->
    @if (showIconPicker()) {
    <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm"
        (click)="closeIconPicker()">
        <div class="bg-[#1d3627] rounded-2xl p-6 w-[90%] max-w-sm" (click)="$event.stopPropagation()">
            <h3 class="text-lg font-bold text-white mb-4">Elige un Icono</h3>
            <div class="grid grid-cols-4 gap-3">
                @for (icon of iconOptions; track icon) {
                <button (click)="selectIcon(icon)"
                    class="flex items-center justify-center h-14 w-14 rounded-xl transition-colors"
                    [class]="selectedIcon() === icon ? 'bg-[#13ec6a] text-[#102217]' : 'bg-[#102217] text-[#13ec6a] hover:bg-[#234832]'">
                    @if (icon.includes('/')) {
                    <img [src]="icon" class="w-8 h-8 object-contain" [class.filter-dark]="selectedIcon() === icon"
                        [class.filter-green]="selectedIcon() !== icon">
                    } @else {
                    <span class="material-symbols-outlined" style="font-size: 28px;">{{ icon }}</span>
                    }
                </button>
                }
            </div>
        </div>
    </div>
    }

    <!-- Category/Equipment Picker Modal -->
    @if (showCategoryPicker()) {
    <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm"
        (click)="closeCategoryPicker()">
        <div class="bg-[#1d3627] rounded-2xl p-6 w-[90%] max-w-sm" (click)="$event.stopPropagation()">
            <h3 class="text-lg font-bold text-white mb-4">Categoría</h3>
            <div class="flex flex-wrap gap-2 mb-6">
                @for (cat of categoryOptions; track cat) {
                <button (click)="selectCategory(cat)"
                    class="px-4 py-2 rounded-full text-sm font-medium transition-colors"
                    [class]="selectedCategory() === cat ? 'bg-[#13ec6a] text-[#102217]' : 'bg-[#102217] text-white border border-[#3d5a4c] hover:border-[#13ec6a]'">
                    {{ cat }}
                </button>
                }
            </div>

            <h3 class="text-lg font-bold text-white mb-4">Equipamiento</h3>
            <div class="flex flex-wrap gap-2">
                @for (eq of equipmentOptions; track eq) {
                <button (click)="selectEquipment(eq)"
                    class="px-4 py-2 rounded-full text-sm font-medium transition-colors"
                    [class]="selectedEquipment() === eq ? 'bg-[#13ec6a] text-[#102217]' : 'bg-[#102217] text-white border border-[#3d5a4c] hover:border-[#13ec6a]'">
                    {{ eq }}
                </button>
                }
            </div>

            <button (click)="closeCategoryPicker()"
                class="w-full mt-6 h-12 bg-[#13ec6a] text-[#102217] rounded-full font-bold">
                Hecho
            </button>
        </div>
    </div>
    }

    <!-- Variant Picker Modal -->
    @if (showVariantPicker()) {
    <div class="fixed inset-0 z-50 flex items-end justify-center bg-black/60 backdrop-blur-sm"
        (click)="closeVariantPicker()">
        <div class="w-full max-w-lg bg-[#102217] rounded-t-3xl p-6 shadow-2xl border-t border-[#13ec6a]/30"
            (click)="$event.stopPropagation()">

            <!-- Modal Header -->
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-white">Seleccionar Ejercicio Alternativo</h3>
                <button (click)="closeVariantPicker()"
                    class="size-8 flex items-center justify-center rounded-full bg-white/10 text-white hover:bg-white/20 transition-colors">
                    <span class="material-symbols-outlined" style="font-size: 20px;">close</span>
                </button>
            </div>

            <!-- Info Message -->
            <p class="text-slate-400 text-sm mb-4">
                Selecciona un ejercicio alternativo para cuando no esté disponible {{ exerciseName() }}.
            </p>

            <!-- Search Input -->
            <div class="relative mb-4">
                <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"
                    style="font-size: 20px;">search</span>
                <input type="text" placeholder="Buscar ejercicio..." [value]="variantSearchQuery()"
                    (input)="variantSearchQuery.set($any($event.target).value)"
                    class="w-full py-3 pl-10 pr-4 rounded-xl bg-[#1d3627] border border-white/10 text-white placeholder:text-slate-500 focus:outline-none focus:border-[#13ec6a]/50">
            </div>

            <!-- Suggestions -->
            <div class="space-y-2 max-h-60 overflow-y-auto always-scroll custom-scrollbar pr-2">
                <p class="text-slate-500 text-xs font-medium uppercase tracking-wider mb-2">Sugerencias</p>

                @for (suggestion of filteredVariantSuggestions(); track suggestion.id) {
                <button (click)="addVariant(suggestion)"
                    class="w-full flex items-center gap-3 p-3 rounded-xl bg-[#1d3627] hover:bg-[#2a4a38] border border-white/5 transition-colors text-left">
                    <span class="size-10 rounded-lg bg-[#13ec6a]/20 flex items-center justify-center">
                        @if (suggestion.icon && suggestion.icon.includes('/')) {
                        <img [src]="suggestion.icon" class="w-5 h-5 object-contain filter-green">
                        } @else {
                        <span class="material-symbols-outlined text-[#13ec6a]" style="font-size: 20px;">{{
                            suggestion.icon || 'fitness_center' }}</span>
                        }
                    </span>
                    <div class="flex-1">
                        <p class="text-white font-medium">{{ suggestion.name }}</p>
                        <p class="text-slate-400 text-xs">{{ suggestion.category }} • {{ suggestion.equipment }}</p>
                    </div>
                </button>
                }

                @if (filteredVariantSuggestions().length === 0) {
                <p class="text-center text-slate-500 py-4">No se encontraron ejercicios</p>
                }
            </div>

            <!-- Create New Exercise Button (Fixed at bottom) -->
            <div class="mt-3 pt-3 border-t border-white/5">
                <button (click)="openCreateExerciseForVariant()"
                    class="w-full flex items-center justify-center gap-2 py-3 rounded-xl border-2 border-dashed border-[#13ec6a]/40 text-[#13ec6a] hover:bg-[#13ec6a]/10 transition-colors">
                    <span class="material-symbols-outlined" style="font-size: 20px;">add</span>
                    Crear nuevo ejercicio
                </button>
            </div>
        </div>
    </div>
    }

    <!-- Confirmation Modal -->
    <app-confirm-modal [isOpen]="showDeleteModal()" title="Eliminar Imagen"
        message="¿Estás seguro de que quieres eliminar esta imagen? Esta acción no se puede deshacer."
        confirmText="Eliminar" cancelText="Cancelar" variant="danger" icon="delete" (confirmed)="confirmDeleteImage()"
        (cancelled)="cancelDeleteImage()">
    </app-confirm-modal>
</div>