<div class="fixed inset-0 w-full flex flex-col overflow-hidden bg-[#102217] font-workout text-white antialiased">
    <!-- Header -->
    <header class="flex items-center justify-between p-4 pb-2 z-10 bg-[#102217]">
        <button (click)="goBack()"
            class="flex size-10 items-center justify-center rounded-full hover:bg-white/10 transition-colors">
            <span class="material-symbols-outlined" style="font-size: 24px;">arrow_back_ios_new</span>
        </button>
        <h2 class="text-lg font-bold leading-tight tracking-tight flex-1 text-center">{{ isEditMode() ? 'Editar Rutina'
            : 'Crear Rutina' }}</h2>
        @if (isEditMode()) {
        <button (click)="deleteRoutine()"
            class="flex size-10 items-center justify-center rounded-full text-red-500 hover:bg-red-500/10 transition-colors">
            <span class="material-symbols-outlined">delete</span>
        </button>
        } @else {
        <div class="size-10"></div>
        }
    </header>

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto no-scrollbar pb-32">
        <!-- Progress Indicator -->
        <div class="flex w-full flex-row items-center justify-center gap-3 py-6">
            <div class="h-2 w-8 rounded-full shadow-[0_0_10px_rgba(19,236,106,0.4)]"
                [class]="currentStep() >= 1 ? 'bg-[#13ec6a]' : 'bg-[#1d3627]'"></div>
            <div class="h-2 w-2 rounded-full" [class]="currentStep() >= 2 ? 'bg-[#13ec6a]' : 'bg-[#1d3627]'"></div>
            <div class="h-2 w-2 rounded-full" [class]="currentStep() >= 3 ? 'bg-[#13ec6a]' : 'bg-[#1d3627]'"></div>
        </div>

        <!-- Title Section -->
        <div class="px-6 pb-6 pt-2">
            <h1 class="text-[32px] font-bold leading-tight tracking-tight text-white">Comienza un nuevo objetivo.</h1>
            <p class="mt-2 text-base text-[#9cacba]">Crea una rutina que se adapte a tu estilo de vida.</p>
        </div>

        <!-- Form Fields -->
        <div class="flex flex-col gap-8 px-6">
            <!-- Routine Name -->
            <div class="flex flex-col gap-3">
                <label class="text-base font-medium leading-normal ml-1" for="routine-name">Nombre de la rutina</label>
                <div class="relative">
                    <input id="routine-name" type="text" [value]="routineName()" (input)="updateName($event)"
                        placeholder="ej: Definición Verano"
                        class="flex w-full rounded-full border border-[#3d5a4c] bg-[#1d3627] h-16 px-6 text-lg font-normal text-white placeholder:text-[#9cacba] focus:border-[#13ec6a] focus:ring-1 focus:ring-[#13ec6a] focus:outline-none transition-all" />
                    <span
                        class="material-symbols-outlined absolute right-6 top-1/2 -translate-y-1/2 text-[#9cacba]">edit</span>
                </div>
            </div>

            <!-- Day Selection -->
            <div class="flex flex-col gap-4">
                <label class="text-base font-medium leading-normal ml-1">Selecciona los días de entrenamiento</label>
                <div class="flex flex-wrap gap-2.5">
                    @for (day of days(); track day.id) {
                    <button (click)="toggleDay(day)"
                        class="flex h-12 flex-1 min-w-[64px] items-center justify-center rounded-full text-sm transition-all"
                        [class]="day.selected 
                                ? 'bg-[#13ec6a] text-[#102217] font-bold shadow-[0_0_15px_rgba(19,236,106,0.4)] scale-105' 
                                : 'border border-[#3d5a4c] bg-[#1d3627] text-white hover:border-[#13ec6a] hover:text-[#13ec6a] font-medium'">
                        {{ day.short }}
                    </button>
                    }
                </div>
                <p class="text-xs text-[#9cacba] ml-1 italic">Toca un día para añadirlo a tu planificación semanal.</p>

                <!-- Edit Mode: Deep Edit Links -->
                @if (isEditMode() && getSelectedDays().length > 0) {
                <div class="mt-4 flex flex-col gap-2">
                    <label class="text-base font-medium leading-normal ml-1">Configurar Días (Ejercicios)</label>
                    @for (day of getSelectedDays(); track day.id) {
                    <div (click)="editDayDetails(day)"
                        class="flex items-center justify-between p-4 rounded-xl bg-[#2a4a38] border border-transparent hover:border-[#13ec6a] cursor-pointer transition-all">
                        <span class="font-bold text-white">{{ day.full }}</span>
                        <div class="flex items-center gap-2 text-[#13ec6a]">
                            <span class="text-sm font-medium">Editar Ejercicios</span>
                            <span class="material-symbols-outlined" style="font-size: 20px;">arrow_forward</span>
                        </div>
                    </div>
                    }
                </div>
                }
            </div>

            <!-- Description -->
            <div class="flex flex-col gap-3">
                <label class="text-base font-medium leading-normal ml-1" for="routine-desc">
                    Descripción <span class="text-[#9cacba] font-normal text-sm ml-1">(Opcional)</span>
                </label>
                <textarea id="routine-desc" [value]="routineDescription()" (input)="updateDescription($event)"
                    placeholder="Describe brevemente tus objetivos..."
                    class="flex w-full min-h-[120px] resize-none rounded-3xl border border-[#3d5a4c] bg-[#1d3627] p-6 text-base font-normal text-white placeholder:text-[#9cacba] focus:border-[#13ec6a] focus:ring-1 focus:ring-[#13ec6a] focus:outline-none transition-all">
                </textarea>
            </div>
        </div>
    </main>

    <!-- Footer Button -->
    <div
        class="absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-[#102217] via-[#102217] to-transparent pt-12 z-20">
        <button (click)="next()" [disabled]="!canProceed()"
            class="group relative flex w-full items-center justify-center gap-3 rounded-full h-14 px-6 text-lg font-bold transition-all hover:bg-opacity-90 active:scale-[0.98]"
            [class]="canProceed() ? 'bg-[#13ec6a] text-[#102217]' : 'bg-[#1d3627] text-[#9cacba] cursor-not-allowed'">
            <span>{{ isEditMode() ? 'Guardar Cambios' : 'Siguiente' }}</span>
            <span class="material-symbols-outlined group-hover:translate-x-1 transition-transform"
                style="font-size: 20px;">arrow_forward</span>
        </button>
    </div>
</div>