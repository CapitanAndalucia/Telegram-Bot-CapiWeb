{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Tickets</title>
    <link rel="stylesheet" href="{% static 'tickets/css/style.css' %}">
</head>
<body>
    <div id="loadingScreen" style="display: flex; justify-content: center; align-items: center; height: 100vh; font-size: 1.5rem;">
        <p>ğŸ”„ Verificando autenticaciÃ³n...</p>
    </div>

    <header class="header" id="mainHeader" style="display:none;">
        <h1>ğŸ“„ Gestor de Tickets</h1>
        <div class="user-info">
            <span>ğŸ‘¤ <span id="username" onclick="openUserModal()" style="cursor: pointer; text-decoration: underline;" title="Click para editar tu perfil">Usuario</span></span>
            <button onclick="logout()" class="logout-btn">ğŸšª Cerrar SesiÃ³n</button>
        </div>
    </header>

    <main class="container" id="mainContent" style="display:none;">
        <!-- Filtros -->
        <section class="filters">
            <input type="date" id="dateFrom">
            <input type="date" id="dateTo">
            <select id="sortOrder">
                <option value="newest" selected>MÃ¡s recientes</option>
                <option value="oldest">MÃ¡s antiguos</option>
            </select>
            <button onclick="clearFilters()">âŒ Limpiar</button>
        </section>

        <!-- Contador -->
        <section class="stats">
            <p id="ticketCount">0 tickets</p>
        </section>

        <!-- BotÃ³n crear -->
        <button class="create-btn" onclick="openModal()">â• Crear Ticket</button>

        <!-- Contenedor de tickets -->
        <section id="ticketsContainer" class="tickets"></section>

        <!-- BotÃ³n cargar mÃ¡s -->
        <button id="loadMoreBtn" onclick="loadMore()" style="display:none;">â¬‡ï¸ Cargar mÃ¡s</button>
    </main>

    <!-- Modal Ticket -->
    <div id="ticketModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">Crear Nuevo Ticket</h2>
            <form id="ticketForm">
                {% csrf_token %}
                <label>Concepto</label>
                <input type="text" id="ticketConcept" required>

                <label>Coste (â‚¬)</label>
                <input type="number" step="0.01" id="ticketCoste" required>

                <label>Fecha</label>
                <input type="date" id="ticketFecha" required>

                <div class="modal-actions">
                    <button type="submit">ğŸ’¾ Guardar</button>
                    <button type="button" onclick="closeModal()">âŒ Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Usuario -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <h2>ğŸ‘¤ Editar Usuario</h2>
            <form id="userForm">
                {% csrf_token %}
                <label>Nombre de usuario</label>
                <input type="text" id="userUsername" required>

                <label>Email</label>
                <input type="email" id="userEmail" required>

                <label>Telegram ID (opcional)</label>
                <input type="number" id="userTelegramId" placeholder="Deja vacÃ­o si no tiene Telegram">
                <small style="color: #888;">El ID de Telegram del usuario para usar el bot</small>

                <label>Nueva contraseÃ±a (opcional)</label>
                <input type="password" id="userPassword" placeholder="Deja vacÃ­o para no cambiar">
                <small style="color: #888;">Solo completa si quieres cambiar la contraseÃ±a</small>

                <div class="modal-actions">
                    <button type="submit">ğŸ’¾ Guardar Cambios</button>
                    <button type="button" onclick="closeUserModal()">âŒ Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const API_URL = "{{ api_url|escapejs }}";
    </script>
    <script src="{% static 'tickets/js/script.js' %}"></script>
</body>
</html>
